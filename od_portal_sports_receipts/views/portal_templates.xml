<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Add a "Collection" card to the portal home (matches the 18e structure you shared) -->
    <template id="portal_my_home_menu_collections" inherit_id="portal.portal_my_home"
              name="Portal Home: Collections card">
        <!-- Insert into the common category grid -->
        <xpath expr="//div[@id='portal_common_category']" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/project/static/src/img/tasks.svg'"/>
                <t t-set="title">Collection</t>
                <t t-set="text">View your sports receipts</t>
                <t t-set="url" t-value="'/my/collections'"/>
                <!-- Force visibility even when there is no counter -->
                <t t-set="config_card" t-value="True"/>
            </t>
        </xpath>
    </template>

    <!-- Collections page -->
    <template id="portal_my_collections" name="Portal: Collections Page">
        <t t-call="portal.portal_layout">
            <!-- Use portal searchbar header style -->
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-set="title">Collection</t>
            <t t-set="page_name">collections</t>

            <!-- Top searchbar (uses sortings provided by controller) -->
            <t t-call="portal.portal_searchbar">
                <t t-set="searchbar_sortings" t-value="dict([(k, v) for k, v in sortings.items()])"/>
                <t t-set="sortby" t-value="sortby"/>
                <t t-set="default_url" t-value="'/my/collections'"/>
            </t>

            <div class="o_portal_wrap">
                <!-- Filters form -->
                <form class="row g-2 mb-3" method="get" action="/my/collections">
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="search" t-att-value="search"
                               t-att-placeholder="'Search by Voucher No.'"/>
                    </div>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="date_from" t-att-value="date_from"
                               t-att-title="'From date'"/>
                    </div>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="date_to" t-att-value="date_to"
                               t-att-title="'To date'"/>
                    </div>
<!--                    <div class="col-md-2">-->
<!--                        <select class="form-select" name="state">-->
<!--                            <option value="">All States</option>-->
<!--                            <option value="draft" t-att-selected="state == 'draft' and 'selected' or None">Draft</option>-->
<!--                            <option value="confirm" t-att-selected="state == 'confirm' and 'selected' or None">Confirm</option>-->
<!--                            <option value="cancel" t-att-selected="state == 'cancel' and 'selected' or None">Cancel</option>-->
<!--                        </select>-->
<!--                    </div>-->
                    <div class="col-md-2 mt-2">
                        <button class="btn btn-primary w-100" type="submit">
                            <i class="fa fa-search me-1"/> Apply
                        </button>
                    </div>
                </form>

                <!-- Table wrapped in standard portal table for consistent look & pager -->
                <t t-call="portal.portal_table">
                    <thead class="table-light">
                        <tr>
                            <th>Voucher No.</th>
                            <th>Date</th>
                            <th>Program</th>
                            <th>Coach</th>
                            <th>Venue</th>
                            <th class="text-end">Fees</th>
                            <th class="text-end">Registration</th>
                            <th class="text-end">VAT Total</th>
                            <th class="text-end">Total</th>
                            <th>State</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="receipts" t-as="rec">
                            <tr>
                                <td><t t-esc="rec.name"/></td>
                                <td><t t-esc="rec.date"/></td>
                                <td><t t-esc="rec.activities_id.display_name"/></td>
                                <td><t t-esc="rec.coach_id.display_name"/></td>
                                <td><t t-esc="rec.venue_id.display_name"/></td>
                                <td class="text-end"><t t-esc="round(rec.od_amount_total or 0.0, 2)"/></td>
                                <td class="text-end"><t t-esc="round(rec.od_transportation_total or 0.0, 2)"/></td>
                                <td class="text-end"><t t-esc="round(rec.od_total_vat or 0.0, 2)"/></td>
                                <td class="text-end"><t t-esc="round(rec.od_grand_total or 0.0, 2)"/></td>
                                <td>
                                    <t t-if="rec.state == 'draft'"><span class="badge bg-secondary">Draft</span></t>
                                    <t t-if="rec.state == 'confirm'"><span class="badge bg-success">Confirm</span></t>
                                    <t t-if="rec.state == 'cancel'"><span class="badge bg-danger">Cancel</span></t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </t>
            </div>
        </t>
    </template>

</odoo>
