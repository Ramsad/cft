<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Pivot -->
        <record id="view_od_account_invoice_analysis_report_pivot" model="ir.ui.view">
            <field name="name">od.account.move.analysis.report.pivot</field>
            <field name="model">od.account.move.analysis.report</field>
            <field name="arch" type="xml">
                <pivot string="Invoices Analysis" disable_linking="1">
                    <field name="categ_id" type="row"/>
                    <field name="date" type="col"/>
                    <field name="price_total" type="measure"/>
                </pivot>
            </field>
        </record>

        <!-- Graph -->
        <record id="view_od_account_invoice_analysis_report_graph" model="ir.ui.view">
            <field name="name">od.account.move.analysis.report.graph</field>
            <field name="model">od.account.move.analysis.report</field>
            <field name="arch" type="xml">
                <graph string="Invoices Analysis">
                    <field name="categ_id"/>
                    <field name="price_total" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Saved filters -->
        <record id="filter_od_invoice_analysis_salespersons" model="ir.filters">
            <field name="name">By Salespersons</field>
            <field name="model_id">od.account.move.analysis.report</field>
            <field name="domain">[]</field>
            <field name="user_id" eval="False"/>
            <field name="context">{'group_by': ['date:month', 'user_id']}</field>
        </record>

        <record id="filter_od_invoice_analysis_product" model="ir.filters">
            <field name="name">By Product</field>
            <field name="model_id">od.account.move.analysis.report</field>
            <field name="domain">[]</field>
            <field name="user_id" eval="False"/>
            <field name="context">{'group_by': ['date:month', 'product_id']}</field>
        </record>

        <record id="filter_od_invoice_analysis_product_category" model="ir.filters">
            <field name="name">By Product Category</field>
            <field name="model_id">od.account.move.analysis.report</field>
            <field name="domain">[]</field>
            <field name="user_id" eval="False"/>
            <field name="context">{'group_by': ['date:month', 'categ_id']}</field>
        </record>

        <record id="filter_od_invoice_analysis_refund" model="ir.filters">
            <field name="name">By Refund</field>
            <field name="model_id">od.account.move.analysis.report</field>
            <field name="domain">[('move_type', '=', 'out_refund')]</field>
            <field name="user_id" eval="False"/>
            <field name="context">{'group_by': ['date:month', 'user_id']}</field>
        </record>

        <record id="filter_od_invoice_analysis_country" model="ir.filters">
            <field name="name">By Country</field>
            <field name="model_id">od.account.move.analysis.report</field>
            <field name="domain">[]</field>
            <field name="user_id" eval="False"/>
            <field name="context">{'group_by': ['date:month', 'country_id']}</field>
        </record>

        <!-- Search -->
        <record id="view_od_account_invoice_analysis_report_search" model="ir.ui.view">
            <field name="name">od.account.move.analysis.report.search</field>
            <field name="model">od.account.move.analysis.report</field>
            <field name="arch" type="xml">
                <search string="Invoices Analysis">
                    <field name="date"/>

                    <!-- Current year -->
                    <filter string="This Year" name="thisyear"
                            domain="[('date','&gt;=', context_today().strftime('%%Y-01-01')),
                           ('date','&lt;=', context_today().strftime('%%Y-12-31'))]"
                            help="Invoices with date in current year"/>

                    <separator/>

                    <!-- States for account.move-like reports: draft/posted/cancel -->
                    <filter string="To Invoice" name="draft" domain="[('state','=','draft')]" help="Draft Invoices"/>
                    <filter string="Posted"     name="posted" domain="[('state','=','posted')]"/>
                    <filter string="Cancelled"  name="cancel" domain="[('state','=','cancel')]"/>

                    <separator/>

                    <!-- Move type filters (v18) -->
                    <filter string="Customer" name="customer"
                            domain="['|', ('move_type','=','out_invoice'), ('move_type','=','out_refund')]"/>
                    <filter string="Vendor" name="supplier"
                            domain="['|', ('move_type','=','in_invoice'), ('move_type','=','in_refund')]"/>

                    <separator/>

                    <filter string="Invoice" name="invoice_only"
                            domain="['|', ('move_type','=','out_invoice'), ('move_type','=','in_invoice')]"/>
                    <filter string="Refund" name="refund_only"
                            domain="['|', ('move_type','=','out_refund'), ('move_type','=','in_refund')]"/>

                    <field name="partner_id" operator="child_of"/>
                    <field name="user_id"/>
                    <field name="categ_id" filter_domain="[('categ_id', 'child_of', self)]"/>

                    <group expand="1" string="Group By">
                        <filter string="Partner"          name="group_partner"  context="{'group_by':'partner_id'}"/>
                        <filter string="Salesperson"      name="group_user"     context="{'group_by':'user_id'}"/>
                        <filter string="Product Category" name="group_categ"    context="{'group_by':'categ_id'}"/>
                        <filter string="Status"           name="group_state"    context="{'group_by':'state'}"/>
                        <filter string="Company"          name="group_company"  context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                        <separator orientation="vertical"/>
                        <filter string="Date"             name="group_date"     context="{'group_by':'date'}"/>
                        <filter string="Due Month"        name="group_due_m"    context="{'group_by':'date_due:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Actions -->
        <record id="action_od_account_invoice_analysis_report_all_supp" model="ir.actions.act_window">
            <field name="name">Invoices Analysis</field>
            <field name="res_model">od.account.move.analysis.report</field>
            <field name="view_mode">pivot,graph</field>
            <field name="context">
                {
                'search_default_posted': 1,
                'search_default_supplier': 1,
                'group_by': [],
                'group_by_no_leaf': 1,
                'search_default_thisyear': 1
                }
            </field>
            <field name="search_view_id" ref="view_od_account_invoice_analysis_report_search"/>
            <field name="help" type="html">
                From this report, you can see the amount invoiced from your vendors. Use the search tool to personalize the analysis.
            </field>
        </record>

        <record id="action_od_account_invoice_analysis_report_all" model="ir.actions.act_window">
            <field name="name">Invoices Analysis</field>
            <field name="res_model">od.account.move.analysis.report</field>
            <field name="view_mode">pivot,graph</field>
            <field name="context">
                {
                'search_default_posted': 1,
                'search_default_customer': 1,
                'group_by': [],
                'group_by_no_leaf': 1,
                'search_default_thisyear': 1
                }
            </field>
            <field name="search_view_id" ref="view_od_account_invoice_analysis_report_search"/>
            <field name="help" type="html">
                From this report, you can see the amount invoiced to your customers. Use the search tool to personalize the analysis.
            </field>
        </record>


        <menuitem name="Invoices" id="menu_action_od_account_invoice_analysis_report_all"
                  action="action_od_account_invoice_analysis_report_all"
                  parent="account.menu_finance_reports" sequence="22"/>


<!--        <act_window id="act_od_account_invoice_analysis_report_partner_relation"-->
<!--                    name="Monthly Turnover"-->
<!--                    groups="account.group_account_manager"-->
<!--                    context="{'search_default_partner_id':[active_id], 'search_default_user':1, 'search_default_thisyear':1, 'group_by_no_leaf':1, 'group_by':[]}"-->
<!--                    res_model="od.account.move.analysis.report"-->
<!--                    src_model="res.partner"-->
<!--                    view_mode="graph"/>-->


    </data>
</odoo>
